# File: resolution_selector.py

class ResolutionSelector:
    """
    –ù–æ–¥–∞ "Resolution Selector" ‚Äî –≤—ã–±–æ—Ä —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏–∑ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —Å –æ–ø—Ü–∏–µ–π
    –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞ (swap —à–∏—Ä–∏–Ω—ã –∏ –≤—ã—Å–æ—Ç—ã).
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (Width, Height, HxW).

    –í–∞–∂–Ω–æ:
    - Preset –∑–∞–¥–∞—ë—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ "ratio ‚Äî W√óH".
    - –ü—Ä–∏ Horizontal_View=True –∑–Ω–∞—á–µ–Ω–∏—è –º–µ–Ω—è—é—Ç—Å—è –º–µ—Å—Ç–∞–º–∏ (–∫–≤–∞–¥—Ä–∞—Ç –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è).
    - –°—Ç—Ä–æ–∫–∞ HxW –≤—Å–µ–≥–¥–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ "HEIGHTxWIDTH".
    """

    # –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞ –ø—Ä–µ—Å–µ—Ç–æ–≤: "label" -> (W, H)
    PRESET_MAP = {
        # 9:16
        "9:16 ‚Äî 144√ó256": (144, 256),
        "9:16 ‚Äî 288√ó512": (288, 512),
        "9:16 ‚Äî 432√ó768": (432, 768),
        "9:16 ‚Äî 540√ó960": (540, 960),
        "9:16 ‚Äî 720√ó1280": (720, 1280),
        "9:16 ‚Äî 864√ó1536": (864, 1536),
        "9:16 ‚Äî 1008√ó1792": (1008, 1792),
        "9:16 ‚Äî 1152√ó2048": (1152, 2048),
        "9:16 ‚Äî 1440√ó2560": (1440, 2560),
        "9:16 ‚Äî 2160√ó3840": (2160, 3840),

        # 3:4
        "3:4 ‚Äî 480√ó640": (480, 640),
        "3:4 ‚Äî 576√ó768": (576, 768),
        "3:4 ‚Äî 768√ó1024": (768, 1024),
        "3:4 ‚Äî 960√ó1280": (960, 1280),
        "3:4 ‚Äî 1056√ó1408": (1056, 1408),
        "3:4 ‚Äî 1152√ó1536": (1152, 1536),
        "3:4 ‚Äî 1200√ó1600": (1200, 1600),
        "3:4 ‚Äî 1440√ó1920": (1440, 1920),
        "3:4 ‚Äî 1536√ó2048": (1536, 2048),

        # 1:1
        "1:1 ‚Äî 256√ó256": (256, 256),
        "1:1 ‚Äî 384√ó384": (384, 384),
        "1:1 ‚Äî 512√ó512": (512, 512),
        "1:1 ‚Äî 640√ó640": (640, 640),
        "1:1 ‚Äî 768√ó768": (768, 768),
        "1:1 ‚Äî 896√ó896": (896, 896),
        "1:1 ‚Äî 1024√ó1024": (1024, 1024),
        "1:1 ‚Äî 1280√ó1280": (1280, 1280),
        "1:1 ‚Äî 1536√ó1536": (1536, 1536),
        "1:1 ‚Äî 2048√ó2048": (2048, 2048),

        # 4:5
        "4:5 ‚Äî 640√ó800": (640, 800),
        "4:5 ‚Äî 768√ó960": (768, 960),
        "4:5 ‚Äî 896√ó1120": (896, 1120),
        "4:5 ‚Äî 1024√ó1280": (1024, 1280),
        "4:5 ‚Äî 1152√ó1440": (1152, 1440),
        "4:5 ‚Äî 1280√ó1600": (1280, 1600),
        "4:5 ‚Äî 1408√ó1760": (1408, 1760),
        "4:5 ‚Äî 1536√ó1920": (1536, 1920),

        # 2:3
        "2:3 ‚Äî 512√ó768": (512, 768),
        "2:3 ‚Äî 640√ó960": (640, 960),
        "2:3 ‚Äî 800√ó1200": (800, 1200),
        "2:3 ‚Äî 1024√ó1536": (1024, 1536),
        "2:3 ‚Äî 1280√ó1920": (1280, 1920),
        "2:3 ‚Äî 1600√ó2400": (1600, 2400),
    }

    @classmethod
    def INPUT_TYPES(cls):
        options = list(cls.PRESET_MAP.keys())
        return {
            "required": {
                "Preset": (options, {"default": "3:4 ‚Äî 576√ó768"}),
                "Horizontal_View": ("BOOLEAN", {"default": False}),
            }
        }

    RETURN_TYPES = ("INT", "INT", "STRING")
    RETURN_NAMES = ("Width", "Height", "HxW")
    FUNCTION = "execute"
    CATEGORY = "utils/image"
    OUTPUT_NODE = False

    def execute(self, Preset, Horizontal_View):
        """
        –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã–±–æ—Ä —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (Width, Height, HxW).

        :param Preset: —Å—Ç—Ä–æ–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ—Å–µ—Ç–æ–≤
        :param Horizontal_View: bool, –µ—Å–ª–∏ True ‚Äî –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ W –∏ H
        """
        try:
            if Preset not in self.PRESET_MAP:
                raise ValueError(f"Unknown preset: '{Preset}'")

            w, h = self.PRESET_MAP[Preset]

            if Horizontal_View:
                width, height = h, w  # swap
            else:
                width, height = w, h

            hxw = f"{height}x{width}"
            return (int(width), int(height), hxw)

        except Exception as e:
            msg = f"[Resolution Selector] Error: {str(e)}"
            print(msg)
            raise RuntimeError(msg) from e


# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–¥—ã –≤ ComfyUI
NODE_CLASS_MAPPINGS = {"ResolutionSelector": ResolutionSelector}
NODE_DISPLAY_NAME_MAPPINGS = {"ResolutionSelector": "üß© Resolution Selector"}
